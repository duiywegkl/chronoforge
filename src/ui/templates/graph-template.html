<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChronoForge Knowledge Graph</title>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <link rel="stylesheet" href="assets/css/graph/graph-visualization.css">
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>正在加载图谱...</p>
    </div>
    
    <div class="controls" id="controls">
        <button onclick="resetZoom()">重置视图</button>
        <button onclick="togglePhysics()">关闭物理效果</button>
        <button onclick="toggleEditMode()" id="editModeBtn">编辑关系</button>
        <button onclick="location.reload()">刷新图谱</button>
        <button onclick="toggleForcePanel()" id="forcePanelBtn">调节力度</button>
    </div>
    
    <!-- 力度调节面板 -->
    <div class="force-panel" id="forcePanel" style="display: none;">
        <h4>物理参数调节</h4>
        <div class="force-control">
            <label>排斥力度:</label>
            <input type="range" id="repulsionSlider" min="-500" max="-20" step="10" value="-150">
            <span id="repulsionValue">-150</span>
        </div>
        <div class="force-control">
            <label>连线长度:</label>
            <input type="range" id="linkDistanceSlider" min="50" max="200" step="10" value="100">
            <span id="linkDistanceValue">100</span>
        </div>
        <div class="force-control">
            <label>碰撞半径:</label>
            <input type="range" id="collisionSlider" min="20" max="50" step="2" value="35">
            <span id="collisionValue">35</span>
        </div>
        <div class="force-control">
            <label>中心引力:</label>
            <input type="range" id="centerStrengthSlider" min="0" max="0.3" step="0.01" value="0">
            <span id="centerStrengthValue">0</span>
        </div>
        <div class="force-control">
            <button onclick="resetToSmart()">智能参数</button>
            <button onclick="applyForceChanges()">应用设置</button>
        </div>
    </div>
    
    <div class="graph-container" id="graphContainer">
        <svg id="graph" width="100%" height="100%"></svg>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <div id="fallback" class="fallback">
        <h2 style="color: #4a90e2; margin-bottom: 30px;">知识图谱 - 简化视图</h2>
        <div class="entity-grid" id="entityGrid">
            <!-- 实体卡片将通过JavaScript动态生成 -->
        </div>
        <p style="opacity: 0.7; font-size: 14px; margin-top: 20px;">
            网络访问受限，无法加载D3.js库，显示简化版本<br>
            <small>已尝试从CDN和本地文件加载D3.js</small><br>
            <small>本地文件路径: ./assets/js/d3.v7.min.js</small>
        </p>
        <button onclick="location.reload()" style="
            background: #4a90e2; color: white; border: none; 
            padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;
        ">重新加载</button>
    </div>
    
    <script>
        // 数据注入点 - 将由Python代码替换，直接赋值给全局变量
        // 注意：不要重新声明，因为变量已在graph-core.js中声明
        window.graphNodes = {{NODES_DATA}};
        window.graphLinks = {{LINKS_DATA}};
        
        console.log('页面加载开始');
        console.log('节点数据:', window.graphNodes);
        console.log('连接数据:', window.graphLinks);
    </script>
    
    <!-- 核心JavaScript -->
    <script src="assets/js/graph/graph-core.js"></script>
</body>
</html>